source("scripts/qw.R")
library(IRanges)

#call like R --vanilla --args filename=\"thing\"
args<-commandArgs()
eval(parse(text=args[grep('filename', args)]))

data <- read.csv(filename, header=F, sep="\t")



#we have to give them names to avoid a bug in ChIPpeakAnnot if we want to use it later
rd <- RangedData(ranges = IRanges(
                   start= data$Region.Start,
                   end = data$Region.End,
                   ),
                 names = as.character(data$PET.ID),
                 space = as.character(data$Chromosome),
                 values = data[,
                   qw(RE1.Type,
                      Left.Motif.Start, Left.Motif.End, Left.Sequence, Left.Direction,
                      Right.Motif.Start, Right.Motif.End, Right.Sequence, Right.Direction,
                      Spacer)]

                 )
#And save the result
save(rd, file="ESC/PET_data/RangedData.R")





to.map<-data[,1:3]
colnames(to.map) <- c("chr","start","end")
mapped <- liftOver(to.map , chain.file="lib/mm8ToMm9.over.chain")
data[,1:3] <- mapped[,qw(chr,start,end)] 

outfile=sub('mm8','mm9',filename)

write.table(data, file=outfile, sep="\t", col.names=F, row.names=F, quote=F)
